# Sprint 4 구현 계획서

## 📋 개요

**목표**: 로그인 후 프로필 생성부터 모임 채팅까지 완전한 사용자 경험 구현

**범위**:
1. 프로필 생성 페이지
2. 가입 완료 결과 페이지
3. 내 모임 목록 페이지
4. 모임 채팅 페이지

---

## 🎯 화면 플로우

```
카카오 로그인 완료
    ↓
프로필 생성 페이지
  (닉네임, 자기소개, 관심사)
    ↓
가입 완료 페이지
  (축하 메시지 + 추천 모임) 
    ↓
내 모임 목록 페이지
  (참여 중인 모임 리스트)
    ↓ [모임 카드 클릭]
모임 채팅 페이지
  (실시간 채팅)
```

---

## 📄 1. 프로필 생성 페이지

### 화면 구성

```
┌─────────────────────────────┐
│   [←]  프로필 만들기         │
├─────────────────────────────┤
│                             │
│      [프로필 사진]           │
│       (+ 아이콘)            │
│                             │
│   닉네임                     │
│   ┌─────────────────────┐  │
│   │ 홍길동              │  │
│   └─────────────────────┘  │
│                             │
│   자기소개                   │
│   ┌─────────────────────┐  │
│   │ 안녕하세요!         │  │
│   │                     │  │
│   └─────────────────────┘  │
│                             │
│   관심사 (최대 5개)          │
│   [운동] [독서] [여행]      │
│   [음악] [요리] ...         │
│                             │
│   ┌─────────────────────┐  │
│   │   완료               │  │
│   └─────────────────────┘  │
└─────────────────────────────┘
```

### 입력 필드

- **프로필 사진** (선택)
  - 기본 아바타 제공
  - 업로드 시 미리보기
  
- **닉네임** (필수)
  - 2-10자 제한
  - 한글, 영문, 숫자 허용
  - 중복 체크 (Mock에서는 생략)
  
- **자기소개** (선택)
  - 최대 100자
  - 멀티라인 입력

- **관심사** (필수, 최소 1개)
  - 미리 정의된 태그 목록
  - 최대 5개 선택
  - 칩(Chip) 형태 UI

### Mock 관심사 태그
```dart
['운동', '독서', '여행', '음악', '요리', 
 '영화', '게임', '사진', '그림', '춤',
 '외국어', '프로그래밍', '반려동물', '패션', '뷰티']
```

---

## 📄 2. 가입 완료 (프로필 확인) 페이지

### 화면 구성

```
┌─────────────────────────────┐
│                             │
│   프로필이 완성되었습니다!   │
│   모임에서 사용할 프로필이   │
│   준비되었습니다             │
│                             │
│   ┌─────────────────────┐  │
│   │                     │  │
│   │   [프로필 사진]      │  │
│   │     (원형)          │  │
│   │                     │  │
│   │    달려라 사자       │  │
│   │                     │  │
│   │  벤드 좋아하는 20대 │  │
│   │  중반 남자입니다.    │  │
│   │  주말마다 한강에서   │  │
│   │  리닝하는 것을       │  │
│   │  좋아해요.          │  │
│   │                     │  │
│   │  건강한 취미를       │  │
│   │  함께해요 되어서     │  │
│   │  반갑습니다.        │  │
│   │  잘부탁드려요!       │  │
│   │                     │  │
│   └─────────────────────┘  │
│                             │
│   ┌─────────────────────┐  │
│   │   다시 수정하기      │  │ ← 연한 회색
│   └─────────────────────┘  │
│                             │
│   ┌─────────────────────┐  │
│   │ 모임 채팅방 입장하기 →│ ← 초록색 (Primary)
│   └─────────────────────┘  │
│                             │
└─────────────────────────────┘
```

### 주요 기능
- **제목**: "프로필이 완성되었습니다!"
- **부제목**: "모임에서 사용할 프로필이 준비되었습니다"
- **프로필 카드**:
  - 원형 프로필 사진 (중앙 정렬)
  - 닉네임 (볼드)
  - 자기소개 (여러 줄)
  - 흰색 배경 + 둥근 모서리 카드
- **다시 수정하기 버튼**: 
  - 연한 회색 배경
  - 프로필 수정 페이지로 이동
- **모임 채팅방 입장하기 버튼**:
  - 초록색 (Primary color)
  - 화살표 아이콘 포함
  - 내 모임 목록으로 이동

---

## 📄 3. 내 모임 목록 페이지

### 화면 구성

```
┌─────────────────────────────┐
│   [☰]  내 모임              │
├─────────────────────────────┤
│                             │
│   참여 중인 모임 (2)         │
│                             │
│   ┌─────────────────────┐  │
│   │ 🏃 주말 러닝 크루    │  │
│   │ 🔴 새 메시지 3개    │  │
│   │ 다음 모임: 토요일    │  │
│   └─────────────────────┘  │
│                             │
│   ┌─────────────────────┐  │
│   │ 🎨 평일 드로잉      │  │
│   │ 마지막 메시지: 1시간 │  │
│   │ 전                   │  │
│   └─────────────────────┘  │
│                             │
│   ┌─────────────────────┐  │
│   │ + 새 모임 찾기      │  │
│   └─────────────────────┘  │
│                             │
└─────────────────────────────┘
```

### 모임 카드 정보
- 모임 이름 + 이모지
- 새 메시지 뱃지 (읽지 않은 메시지 수)
- 다음 일정 또는 마지막 활동 시간
- 클릭 시 채팅 페이지로 이동

### Mock 데이터
```dart
[
  {
    "id": 1,
    "name": "주말 러닝 크루",
    "emoji": "🏃",
    "unreadCount": 3,
    "nextMeeting": "토요일 오전 8시",
    "lastMessage": "내일 뵙겠습니다~",
    "lastMessageTime": "2025-12-06T15:30:00"
  },
  {
    "id": 2,
    "name": "평일 드로잉 클럽",
    "emoji": "🎨",
    "unreadCount": 0,
    "lastMessage": "오늘 수고하셨어요!",
    "lastMessageTime": "2025-12-06T14:20:00"
  }
]
```

---

## 📄 4. 모임 채팅 페이지

### 화면 구성

```
┌─────────────────────────────┐
│  [←] 🏃 주말 러닝 크루  [☰]  │
├─────────────────────────────┤
│                             │
│   ── 2025년 11월 20일 ──    │
│                             │
│  런데뷰 시작 일자가          │
│  임박했습니다!               │
│  (시스템 메시지 - 중앙 정렬) │
│                             │
│  ○ [채봇봇] 오후 4:36        │
│  ┌─────────────────────┐   │
│  │ 주말 러닝크루        │   │ ← 카드 메시지
│  │ 가입을 환영합니다!   │   │
│  │                     │   │
│  │ 모임을 시작하기 전,  │   │
│  │ 첫 가이드를 꼭      │   │
│  │ 읽어보세요 :)       │   │
│  │                     │   │
│  │  [가이드 읽기]      │   │ ← 버튼
│  └─────────────────────┘   │
│                             │
│  ○ [김러너] 오후 6:38        │
│  안녕하세요 사자님!          │
│  가입을 환영합니다 😊 😊 😊  │
│                             │
│  모임 규칙 한번 읽어주시고,  │
│  확인하셨으면 좋아요 버튼    │
│  눌러 주세요!!              │
│                             │
│  ○ [열심히뛰린다] 오후 6:40  │
│  마저 이번주에도 다같이      │
│  만나기로 했는데,           │
│  스케줄 괜찮으실까요?       │
│                             │
│  ┌─────────────────────┐   │
│  │ 🗓️ 일정 제안         │   │ ← 이벤트 카드
│  │                     │   │   (초록색 테두리)
│  │ 이번주 토요일 오전 8시│   │
│  │                     │   │
│  │ 📍 한강공원 뚝섬유원지│   │
│  │ 💬 5km 가벼운 달리기 │   │
│  │    브런치            │   │
│  │                     │   │
│  │ 응답 당사           │   │
│  │ │ 1명 불참          │   │
│  │                     │   │
│  │  [참석]    [불참]    │   │ ← 선택 버튼
│  └─────────────────────┘   │
│                             │
│                  [달려라 사자]│
│          네 좋습니다! 😊 😊  │
│          완전 기대됩니다!!   │
│                       오후 8:44│
│                             │
├─────────────────────────────┤
│ [+] [메시지 입력...]    [🎯] │ ← 전송 버튼 (초록색)
└─────────────────────────────┘
```

### 주요 UI 요소

#### 1. 헤더
- **뒤로 가기** 버튼 (좌측)
- **모임 이름** + 이모지 (중앙)
- **메뉴** 버튼 (우측, 햄버거 아이콘)

#### 2. 날짜 구분선
- "YYYY년 MM월 DD일" 형식
- 중앙 정렬
- 회색 텍스트

#### 3. 시스템 메시지
- "런데뷰 시작 일자가 임박했습니다!"
- 중앙 정렬
- 연한 회색 배경 또는 텍스트만

#### 4. 일반 메시지
- **왼쪽 (상대방)**:
  - 프로필 아이콘 (원형, 작은 크기)
  - 이름 + 시간
  - 메시지 말풍선 (흰색/연한 회색)
  - 이모지 지원
- **오른쪽 (내 메시지)**:
  - 이름 표시 안 함
  - 메시지 말풍선 (초록색 or Primary)
  - 시간 (왼쪽에 표시)

#### 5. 카드 메시지 (챗봇 메시지)
- **제목**: "주말 러닝크루" (볼드)
- **부제**: "가입을 환영합니다!"
- **내용**: 안내 텍스트
- **버튼**: "가이드 읽기" (테두리 버튼)
- 둥근 모서리 카드
- 그림자 효과

#### 6. 이벤트 초대 카드
- **아이콘**: 🗓️ (일정 제안)
- **이벤트 제목**: "이번주 토요일 오전 8시"
- **위치**: 📍 한강공원 뚝섬유원지
- **설명**: 💬 5km 가벼운 달리기 브런치
- **참석 현황**: "응답 당사 1명 불참"
- **액션 버튼**: 
  - "참석" (초록색)
  - "불참" (회색/테두리)
- **초록색 테두리** (강조)

#### 7. 하단 입력창
- **+ 버튼**: 첨부 파일 (좌측)
- **입력창**: "메시지 입력..." 플레이스홀더
- **전송 버튼**: 🎯 아이콘 (초록색 원형)

### 메시지 타입

```dart
enum MessageType {
  system,      // 시스템 메시지 (중앙 정렬)
  text,        // 일반 텍스트 메시지
  card,        // 카드형 메시지 (가이드, 공지 등)
  event,       // 이벤트 초대 카드
}
```

### Mock 채팅 데이터
```dart
[
  // 시스템 메시지
  {
    "id": 1,
    "type": "system",
    "message": "런데뷰 시작 일자가 임박했습니다!",
    "timestamp": "2025-11-20T16:30:00"
  },
  // 카드 메시지 (챗봇)
  {
    "id": 2,
    "type": "card",
    "senderId": 0,
    "senderName": "채봇봇",
    "cardData": {
      "title": "주말 러닝크루",
      "subtitle": "가입을 환영합니다!",
      "content": "모임을 시작하기 전, 첫 가이드를 꼭 읽어보세요 :)",
      "buttonText": "가이드 읽기",
      "buttonAction": "/guide"
    },
    "timestamp": "2025-11-20T16:36:00",
    "isMe": false
  },
  // 일반 텍스트 메시지
  {
    "id": 3,
    "type": "text",
    "senderId": 2,
    "senderName": "김러너",
    "message": "안녕하세요 사자님!\n가입을 환영합니다 😊 😊 😊\n\n모임 규칙 한번 읽어주시고,\n확인하셨으면 좋아요 버튼 눌러 주세요!!",
    "timestamp": "2025-11-20T18:38:00",
    "isMe": false
  },
  {
    "id": 4,
    "type": "text",
    "senderId": 3,
    "senderName": "열심히뛰린다",
    "message": "마저 이번주에도 다같이 만나기로 했는데,\n스케줄 괜찮으실까요?",
    "timestamp": "2025-11-20T18:40:00",
    "isMe": false
  },
  // 이벤트 초대 카드
  {
    "id": 5,
    "type": "event",
    "senderId": 3,
    "senderName": "열심히뛰린다",
    "eventData": {
      "title": "일정 제안",
      "eventTime": "이번주토요일 오전 8시",
      "location": "한강공원 뚝섬유원지",
      "description": "5km 가벼운 달리기 브런치",
      "attendStatus": {
        "attending": 1,
        "declined": 1
      },
      "myStatus": null
    },
    "timestamp": "2025-11-20T18:40:30",
    "isMe": false
  },
  // 내 메시지
  {
    "id": 6,
    "type": "text",
    "senderId": 1,
    "senderName": "달려라 사자",
    "message": "네 좋습니다! 😊 😊\n완전 기대됩니다!!",
    "timestamp": "2025-11-20T20:44:00",
    "isMe": true
  }
]
```

---

## 📦 데이터 모델

### 1. ProfileModel
```dart
class Profile {
  final int userId;
  final String nickname;
  final String? bio;
  final String? profileImageUrl;
  final List<String> interests;
  final DateTime createdAt;
}
```

### 2. ClubModel (확장)
```dart
class Club {
  final int id;
  final String name;
  final String emoji;
  final int unreadCount;
  final String? nextMeeting;
  final String? lastMessage;
  final DateTime? lastMessageTime;
}
```

### 3. ChatMessageModel
```dart
class ChatMessage {
  final int id;
  final int senderId;
  final String senderName;
  final String message;
  final DateTime timestamp;
  final bool isMe;
}
```

### 4. ChatRoomModel
```dart
class ChatRoom {
  final int clubId;
  final String clubName;
  final String clubEmoji;
  final List<ChatMessage> messages;
}
```

---

## 🎨 디자인 가이드

### 색상
- **Primary**: 기존 AppColors.primary
- **Success**: 가입 완료 (초록색)
- **Message Bubble (Mine)**: Primary color with opacity
- **Message Bubble (Others)**: Grey 100
- **Unread Badge**: Red (알림)

### 타이포그래피
- **페이지 제목**: H1 (24px, Bold)
- **카드 제목**: H3 (18px, SemiBold)
- **메시지**: Body (14px)
- **시간**: Caption (12px, Grey)

### 여백
- **카드 간격**: 16px
- **내부 패딩**: 16px
- **메시지 간격**: 8px

---

## 🔧 Mock API

### 1. 프로필 생성
```
POST /api/v1/profile
{
  "nickname": "홍길동",
  "bio": "안녕하세요!",
  "interests": ["운동", "독서", "여행"]
}

Response:
{
  "success": true,
  "data": {
    "userId": 1,
    "nickname": "홍길동",
    ...
  }
}
```

### 2. 내 모임 목록 조회
```
GET /api/v1/clubs/my

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "주말 러닝 크루",
      ...
    }
  ]
}
```

### 3. 채팅 메시지 조회
```
GET /api/v1/clubs/{clubId}/messages

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "message": "안녕하세요~",
      ...
    }
  ]
}
```

### 4. 메시지 전송
```
POST /api/v1/clubs/{clubId}/messages
{
  "message": "안녕하세요!"
}

Response:
{
  "success": true,
  "data": {
    "id": 4,
    "message": "안녕하세요!",
    ...
  }
}
```

---

## 🗂️ 파일 구조

```
lib/
├── models/
│   ├── entities/
│   │   ├── profile_model.dart          [NEW]
│   │   ├── club_model.dart             [UPDATE]
│   │   ├── chat_message_model.dart     [NEW]
│   │   └── chat_room_model.dart        [NEW]
│   └── api/
│       ├── profile_api.dart            [NEW]
│       ├── club_api.dart               [NEW]
│       └── chat_api.dart               [NEW]
├── viewmodels/
│   ├── profile_viewmodel.dart          [NEW]
│   ├── my_clubs_viewmodel.dart         [NEW]
│   └── chat_viewmodel.dart             [NEW]
└── views/
    ├── pages/
    │   ├── profile/
    │   │   ├── profile_setup_page.dart     [NEW]
    │   │   └── signup_complete_page.dart   [NEW]
    │   ├── clubs/
    │   │   └── my_clubs_page.dart          [NEW]
    │   └── chat/
    │       └── chat_room_page.dart         [NEW]
    └── widgets/
        ├── profile/
        │   ├── interest_chip.dart          [NEW]
        │   └── profile_photo_picker.dart   [NEW]
        ├── clubs/
        │   └── club_card.dart              [NEW]
        └── chat/
            ├── chat_message_bubble.dart    [NEW]
            ├── date_divider.dart           [NEW]
            └── message_input.dart          [NEW]
```

---

## ✅ 구현 순서

1. **데이터 모델 생성** (Phase 5)
   - Profile, Club, ChatMessage, ChatRoom

2. **프로필 생성 페이지** (Phase 1)
   - UI 구현
   - 관심사 선택 로직
   - Mock API 연동

3. **가입 완료 페이지** (Phase 2)
   - 축하 화면
   - 추천 모임 표시

4. **내 모임 목록 페이지** (Phase 3)
   - 모임 카드 리스트
   - Mock 데이터

5. **채팅 페이지** (Phase 4)
   - 메시지 리스트
   - 입력창
   - 전송 기능 (Mock)

6. **화면 플로우 연결** (Phase 6)
   - 라우팅 설정
   - 데이터 전달

7. **테스트** (Phase 7)
   - 전체 플로우 검증

---

## 🚀 다음 단계

구현 완료 후:
- WebSocket 실시간 채팅 (Sprint 5)
- 모임 상세 정보 페이지
- 모임 검색/필터링
- 프로필 수정 기능

---

**작성일**: 2025-12-06  
**Sprint**: 4  
**예상 소요 시간**: 5-6시간
